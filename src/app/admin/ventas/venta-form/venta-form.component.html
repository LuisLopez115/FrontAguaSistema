<form (ngSubmit)="guardarVenta()" class="container mt-4">

  <div class="mb-3">
    <label for="cliente" class="form-label">Cliente</label>
    <select
      id="cliente"
      [(ngModel)]="ventaForm.usuarioId"
      name="usuarioId"
      required
      class="form-select"
    >
      <option value="" disabled>-- Selecciona un cliente --</option>
      <option *ngFor="let cliente of clientes" [value]="cliente.id">
        {{ cliente.nombre }}
      </option>
    </select>
  </div>

  <div class="mb-3">
    <label for="comentarios" class="form-label">Comentarios</label>
    <input
      id="comentarios"
      type="text"
      [(ngModel)]="ventaForm.comentarios"
      name="comentarios"
      class="form-control"
    />
  </div>

 <div *ngFor="let detalle of ventaForm.detalles; let i = index" class="mb-3 border p-3 rounded">
  <label class="form-label">Detalle {{ i + 1 }}</label>

  <select
    [(ngModel)]="detalle.productoId"
    name="productoId{{i}}"
    required
    class="form-select mb-2"
  >
    <option value="" disabled>-- Selecciona un producto --</option>
    <option *ngFor="let prod of productos" [value]="prod.id">
      {{ prod.nombre }}
    </option>
  </select>

  <input
    type="number"
    [(ngModel)]="detalle.cantidad"
    name="cantidad{{i}}"
    min="1"
    required
    class="form-control mb-2"
    placeholder="Cantidad"
  />

  <input
    type="number"
    [(ngModel)]="detalle.precioUnitario"
    name="precioUnitario{{i}}"
    min="0"
    step="0.01"
    required
    class="form-control mb-2"
    placeholder="Precio Unitario"
  />

  <button type="button" class="btn btn-danger btn-sm" (click)="quitarDetalle(i)">
    Eliminar detalle
  </button>
</div>


  <button
    type="button"
    class="btn btn-primary mb-3"
    (click)="agregarDetalle()"
  >
    Agregar detalle
  </button>

  <div>
    <button type="submit" class="btn btn-success me-2">
      {{ ventaForm.id ? 'Actualizar Venta' : 'Crear Venta' }}
    </button>

    <button
      type="button"
      class="btn btn-secondary"
      (click)="cancelarEdicion()"
    >
      Cancelar
    </button>
  </div>

</form>
